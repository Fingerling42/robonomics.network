---
title: Δοκιμή του Neon EVM με Έξυπνα Συμβόλαια Robonomics
date: 2022-10-03
published: true
locale: 'el'
tags: ['Robonomics in Ethereum', 'Collaborations', 'Smart Contracts', 'Neon']
cover_image: /blog/images/testing-neon-with-robonomics/blog_cover_neon_multi-agent.jpg
description: "Σκοπός αυτών των δοκιμών ήταν η επικύρωση της ετοιμότητας της πλατφόρμας Neon για μετάβαση στο στάδιο παραγωγής χρησιμοποιώντας έξυπνα συμβόλαια Robonomics, τα οποία επιτρέπουν σε κυβερνο-φυσικά συστήματα (ρομπότ) να πραγματοποιούν τεχνικο-οικονομικές συναλλαγές."
abstract: ""
---

## TL;DR

Σκοπός αυτών των δοκιμών ήταν η επικύρωση της ετοιμότητας της πλατφόρμας [Neon](https://neon-labs.org/) για μετάβαση στο στάδιο παραγωγής χρησιμοποιώντας έξυπνα συμβόλαια Robonomics, τα οποία επιτρέπουν σε κυβερνο-φυσικά συστήματα (ρομπότ) να πραγματοποιούν τεχνικο-οικονομικές συναλλαγές.

Στο δίκτυο Robonomics, η αλληλεπίδραση καθιερώνεται μεταξύ δύο μερών: Υποσχόμενος (Promisee) - αυτός που παραγγέλνει την υπηρεσία, στέλνει μια περιγραφή της τεχνικής εργασίας και μεταφέρει κεφάλαια για την εκτέλεσή της· Υποσχόμενος Εκτελεστής (Promisor) - αυτός που εκτελεί την υπηρεσία. Δοκιμάστηκε ένα τυπικό σενάριο, κατά το οποίο συνάπτεται ένα συμβόλαιο υποχρέωσης μεταξύ Υποσχόμενου και Υποσχόμενου Εκτελεστή - ακολούθησε επικύρωση του παραγόμενου έργου από τρίτο μέρος και πληρωμή προμήθειας στον κόμβο που συνόδευσε το συμβόλαιο μεταξύ των μερών.

Για το παράδειγμα αυτό, χρησιμοποιήθηκε προσομοίωση ενός ρομποτικού βραχίονα, στον οποίο ζητήθηκε να εκτελέσει μια ακολουθία ενεργειών. Οι δοκιμές ήταν επιτυχείς.

## Εύρος και Στόχοι της Δοκιμής

Οι μηχανικοί της [Multi-Agent Systems](https://multi-agent.io/) εργάζονται με το [Robonomics Network](https://robonomics.network/) εδώ και αρκετά χρόνια. Η πρώτη υλοποίηση του Robonomics Network δημιουργήθηκε για το δίκτυο Ethereum. Πρόκειται για ένα σύνολο έξυπνων συμβολαίων για επικοινωνία μηχανής προς μηχανή.

Ο πυρήνας του Robonomics Network είναι το συμβόλαιο [Liability](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Liability.sol), ένα έξυπνο συμβόλαιο που αναπαράγει τη συνήθη σχέση μεταξύ του πελάτη μιας υπηρεσίας (Promisee) και του παρόχου υπηρεσίας (Promisor), και περιλαμβάνει τις τεχνικές και οικονομικές παραμέτρους της συναλλαγής μεταξύ τους. Τα μέρη μπορεί να είναι είτε ένας αυτόνομος πράκτορας και ένα άτομο (αλληλεπίδραση ανθρώπου-μηχανής), είτε δύο καθαρά αυτόνομοι πράκτορες (αλληλεπίδραση μηχανής-μηχανής). Ο Promisee και ο Promisor μεταδίδουν μηνύματα με τις παραμέτρους τηςτην τεχνικο-οικονομική τους συναλλαγή, και στη συνέχεια η ολοκλήρωση της συναλλαγής παρέχεται από έναν ειδικό κόμβο - τον Πάροχο - ο οποίος αναζητά αντιστοιχίες αυτών των παραμέτρων. Οι Πάροχοι ελέγχονται από το [Lighthouse](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Lighthouse.sol), που είναι ένα ειδικό έξυπνο συμβόλαιο το οποίο εκτελεί μια συναλλαγή όταν ο πάροχος διαπιστώσει μια αντιστοιχία στην αγορά μεταξύ των μερών.

Υπάρχουν τρία σενάρια στα οποία μπορεί να πραγματοποιηθεί η εκπλήρωση μιας υποχρέωσης:

1. Μια απλή δέσμευση (χωρίς επαλήθευση του τελικού αποτελέσματος και χωρίς προμήθεια στους κόμβους Παρόχου)
2. Υποχρέωση με προμήθεια που καταβάλλεται στον Πάροχο
3. Δέσμευση με προμήθεια στον Πάροχο και επικύρωση των αποτελεσμάτων με τη βοήθεια τρίτου μέρους - παρατηρητικού δικτύου.

Σκοπός αυτής της δοκιμής είναι να ελεγχθεί το πιο σύνθετο, τρίτο σενάριο του Robonomics στην πλατφόρμα Neon EVM.

## Περιγραφή Σεναρίων Δοκιμών

Καθώς αναπτύσσουμε τις βιομηχανικές ζώνες και τις υποδομές των σύγχρονων πόλεων, η εμφάνιση πλήρως αυτοματοποιημένων επιχειρήσεων και υπηρεσιών που ελέγχονται από κυβερνο-φυσικά συστήματα (CPS) και παρέχουν τις υπηρεσίες τους ως αυτόνομοι πράκτορες είναι εξαιρετικά πιθανή. Από αυτή την άποψη, μπορούμε επίσης να αναμένουμε το σχηματισμό δικτύων αυτόνομων CPS με σκοπό την αύξηση της ταχύτητας και της ποιότητας της επικοινωνίας στη διαδικασία παραγωγής και παροχής υπηρεσιών.

Για να αξιοποιηθούν πλήρως οι δυνατότητες των έξυπνων συμβολαίων, επιλέχθηκε ένα σενάριο αλληλεπίδρασης μεταξύ δύο αυτόνομων οικονομικών παραγόντων. Ας εξετάσουμε τον κύκλο ζωής μιας υποχρέωσης στο δίκτυο Robonomics:

![Liability Life Cycle](/blog/images/testing-neon-with-robonomics/step-by-step-3.jpg)

Στο παραπάνω σχήμα φαίνεται ότι ο πάροχος του δικτύου Robonomics καλεί το συμβόλαιο Lighthouse, το οποίο με τη σειρά του καλεί το [contract factory](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Factory.sol) για να δημιουργήσει το συμβόλαιο Liability. Το συμβόλαιο Liability περιέχει δεδομένα σχετικά με τη συναλλαγή, όπως τους όρους αναφοράς, την πληρωμή για την υπηρεσία, τη διεύθυνση του επικυρωτή και την προθεσμία.

Για να μάθετε περισσότερα σχετικά με τις πιθανές περιπτώσεις χρήσης του Robonomics, επισκεφθείτε τη σελίδα Robonomics [R&D](https://wiki.robonomics.network/docs/en/r-and-d-based-on-robonomics-network/#launching-a-drone-under-the-control-of-a-decentralized-computer)!

Για να αναπαραχθεί ολόκληρη η υποδομή του Robonomics στο δίκτυο Neon, θα υλοποιήσουμε ένα σενάριο εκτόξευσης ρομπότ μέσω ενός συμβολαίου Liabilityπαρόμοιο με αυτό το [παράδειγμα](https://wiki.robonomics.network/docs/en/kuka/). Εάν το script μπορεί να επαναληφθεί, τότε όλες οι λειτουργίες θα λειτουργήσουν.

## Παραδοτέα

Ο πηγαίος κώδικας για τα συμβόλαια Robonomics είναι διαθέσιμος [εδώ](https://github.com/airalab/robonomics_contracts).
Τα συμβόλαια χρησιμοποιούν πολλές δυνατότητες της Ethereum VM που περιλαμβάνουν:

- ERC20 [XRT](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/XRT.sol) Token
- [Factory](https://github.com/airalab/robonomics_contracts/blob/master/contracts/robonomics/Factory.sol)
- Δικό του συμβόλαιο για [ENS](https://github.com/airalab/robonomics_contracts/blob/master/contracts/ens/ENS.sol)
- [Proxy](https://github.com/airalab/robonomics_contracts/blob/master/contracts/misc/SharedCode.sol) για συμβόλαια
- Διάφορους τροποποιητές και ρόλους στα συμβόλαια

Διευθύνσεις συμβολαίων στο δίκτυο Neon devnet https://devnet.neonevm.org

| Όνομα Συμβολαίου | Διεύθυνση                                    |
|------------------|----------------------------------------------|
| Migrations       | 0x1DC538bE2C8572509a571B150f11aB55E52EF12E   |
| ENS              | 0xa7AEa12F60D0278F01e14DBC7cc459d04d051406   |
| DutchAuction     | 0xF44F8803548D72Dbc3E28340EFD7b5328aa4F058   |
| Liability        | 0xA694196351dc1488e3884eCc6b650F0d8D55346a   |
| Lighthouse       | 0x80FB5CC4c396E272b56700E6ffF5DBf4661013A8   |
| XRT              | 0x3322d7D99cF65Cab5A92073c928b5E9674af3c29   |
| PublicAmbix      | 0x85c03bE5ccFf11E79a0A776D183eF067590549d1   |
| Factory          | 0xCFa833bF0D46369D9024f95c9C8dFa1            |E4a07806C |
| PublicResolver | 0xAC9E9AA8A4cB524FE87f2b14489F1D6bE68dc46e |

[Πηγαίος κώδικας](https://github.com/Multi-Agent-io/neon-kuka-demo) για το σενάριο

## Αλλαγές που έγιναν στα αρχικά συμβόλαια

Τα συμβόλαια είναι γραμμένα για Solidity 0.5.0. Ως εκ τούτου, δεν απαιτήθηκαν αλλαγές κατά την ανάπτυξη και χρήση των συμβολαίων.

## Ροή δοκιμών

Γενικά, η δοκιμή συνίσταται στην αποστολή αντίστοιχων μηνυμάτων από έναν πράκτορα σε έναν άλλο.

Στη συνέχεια, ο Promisor βρίσκει ένα νέο συμβόλαιο liability στο δίκτυο και ξεκινά να το εκτελεί. Μετά την ολοκλήρωση της εργασίας, αποστέλλεται ένα μήνυμα με το αποτέλεσμα, το οποίο στη συνέχεια καταγράφεται στο συμβόλαιο.

Βήμα προς βήμα οδηγίες για την εκκίνηση υπάρχουν στο [README.md](https://github.com/Multi-Agent-io/neon-kuka-demo/blob/main/README.md)

## Αναλυτικά Αποτελέσματα Δοκιμών

Screencast της διαδικασίας

<YouTube id="https://youtu.be/fYJVF7KrNnI" posterQuality="max" />

![Liability](/blog/images/testing-neon-with-robonomics/liability.jpg)

Όταν ξεκινά η προσομοίωση, δημιουργείται ένα μήνυμα προσφοράς και ένα μήνυμα ζήτησης έρχεται από τον Promisee, μετά το οποίο δημιουργείται ένα συμβόλαιο Liability χρησιμοποιώντας τη συνάρτηση createLiability του συμβολαίου Lighthouse. Με τη βοήθεια του συμβολαίου XRT, τα tokens μεταφέρονται από τη διεύθυνση του Promisee στη διεύθυνση του συμβολαίου Liability.

Αφού ανακαλυφθεί ένα νέο συμβόλαιο Liability στο Neon devnet, ο πράκτορας ξεκινά να εργάζεται. Το αποτέλεσμα της εργασίας (τηλεμετρία) γράφεται σε ένα αρχείο και αποστέλλεται στο IPFS, το hash από το αρχείο αποθηκεύεται ως αποτέλεσμα.

Μετά την ολοκλήρωση της εργασίας, το συμβόλαιο Liability ολοκληρώνεται χρησιμοποιώντας τη συνάρτηση finalizeLiability() του συμβολαίου Lighthouse και τα tokens μεταφέρονται από τη διεύθυνση του Liability στις διευθύνσεις του Promisor και του Validator.

Η επιτυχής εκτέλεση της προσομοίωσης έδειξε ότι όλα τα συμβόλαια λειτούργησαν σωστά και η πλατφόρμα Neon λειτουργεί.

## Μειονεκτήματα της πλατφόρμας Neon

### Το Truffle αποτυγχάνει αν δεν λάβει απάντηση από το δίκτυο

Κατά τη διαδικασία ανάπτυξης των συμβολαίων, διαπιστώθηκε ότι το proxy δεν επιστρέφει πάντα απάντηση εγκαίρως, γι' αυτό το Truffle καταλήγει με σφάλμα:

<RbCode>

```sh
TypeError: Cannot read properties of null (reading 'from')                                    
    at Web3InterfaceAdapter.(<anonymous>) (/usr/lib/node_modules/truffle/build/webpack:/packages
/interface-adapter/dist/adapter/web3/index.js:71:1)                                           
    at Generator.next (<anonymous>)                                                          
    at fulfilled (/usr/lib/node_modules/truffle/build/webpack:/packages/interface-adapter/dist
/adapter/web3/index.js:5:43)                                                                  
    at runMicrotasks (<anonymous>)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
Truffle v5.5.23 (core: 5.5.23)
Node v16.14.0
```
</RbCode>

Δεν ήταν δυνατό να βρεθεί συσχέτιση μεταξύ των συνθηκών δοκιμής και της εμφάνισης ενός σφάλματος, αλλά το πιο πιθανό είναι ότι το Neon EVM δεν μπορεί να στείλει απόδειξη συναλλαγής και το Truffle δεν μπορεί να επεξεργαστεί μια απάντηση Null.

Αν προσθέσουμε timeout και retry εδώ [index.ts#L75](https://github.com/trufflesuite/truffle/blob/develop/packages/interface-adapter/lib/adapter/web3/index.ts#L75), τότε η ανάπτυξη θα πρέπει να προχωρήσει χωρίς σφάλματα.

### Χωρίς WS/WSS Endpoint

Το Neon EVM δεν διαθέτει WS/WSS endpoint σε αντίθεση με το Ethereum, γεγονός που καθιστά αδύνατη τη συνδρομή σε συμβάντα από το δίκτυο. Επομένως, κατά τη διάρκεια των δοκιμών, παρακολουθούσαμε τα συμβάντα χειροκίνητα.

### Χωρίς Ονόματα Συμβάντων

Το Neon EVM επιστρέφει μάλλον φτωχές περιγραφές συμβάντων μετά από μια συναλλαγή, για παράδειγμα:

<RbCode>

```sh
 events: {
    '0': {
      address: '0xCFa833bF0D46369D9024f95c9C8dFa1E4a07806C',
      transactionHash: '0x9894a984e6b3f6ce469c8837e11739f6e50d00216cf7c5bc3d32da106a58d50a',
      transactionLogIndex: '0x1',
      blockHash: '0x72040f317d3a469d30327d4e1def903790b70dbede46b4f0ea4f28f30a679a80',
      blockNumber: 156073183,
      transactionIndex: 0,
      logIndex: 1,
      id: 'log_e51e2f9f',
      returnValues: Result {},
      event: undefined,
      signature: null,
      raw:[Object]
    },
...
```
</RbCode>

Αντί για 0, 1, κ.λπ., αναμέναμε να δούμε ονομαστικά γεγονότα.

## Συμπέρασμα

Χρησιμοποιώντας την πλατφόρμα Neon EVM, δοκιμάστηκε επιτυχώς ένα σενάριο κατά το οποίο συνάπτεται ένα συμβόλαιο ευθύνης μεταξύ ενός Υποσχεθέντος και ενός Υποσχόμενου, με επακόλουθη επικύρωση του αποτελέσματος της εργασίας από τρίτο μέρος. Επιπλέον, συμμετείχε και ένας Πάροχος, ο οποίος έλεγξε τη σύμπτωση προσφοράς και ζήτησης μεταξύ των μερών και έλαβε προμήθεια για αυτή την εργασία.

Η επίδειξη χρησιμοποίησε μια προσομοίωση ενός ρομποτικού βραχίονα που προσλήφθηκε για να εκτελέσει μια ακολουθία ενεργειών. Ως αποτέλεσμα της εργασίας, το ρομπότ έστειλε ένα αρχείο με τηλεμετρία που ελήφθη κατά τη διάρκεια της αποστολής.

Παρά κάποιες ιδιαιτερότητες στη λειτουργία του δικτύου, τελικά όλα τα συμβόλαια που συμμετείχαν έδειξαν τη λειτουργικότητά τους στο περιβάλλον Neon.