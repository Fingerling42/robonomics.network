---
title: "Controle Remoto Seguro de Robótica: Solução Robonomics"
date: 2024-04-19
published: true
locale: 'pt'
cover_image: /blog/images/secure-robotics-remote-control-via-web3/remote_control_cover.png
description: "A conexão remota e o controle do seu próprio dispositivo inteligente é um recurso muito popular entre os usuários. No entanto, uma tarefa tão trivial ainda causa muitas dificuldades para usuários inexperientes - desde superar o NAT até questões de segurança. Em um novo artigo, mostraremos como essas dificuldades podem ser superadas com a ajuda do Robonomics."
related: ['Robonomics Helps Enable Rust for ROS 2', 'Automation: Home meets Industrial']
abstract: "A conexão remota e o controle do seu próprio dispositivo inteligente é um recurso muito popular entre os usuários. No entanto, uma tarefa tão trivial ainda causa muitas dificuldades para usuários inexperientes - desde superar o NAT até questões de segurança. Em um novo artigo, mostraremos como essas dificuldades podem ser superadas com a ajuda do Robonomics."
tags: ['ROS 2', 'Smart Home']
---

No artigo anterior, falamos sobre como utilizamos as vantagens das soluções industriais na infraestrutura de uma casa inteligente robotizada. Mostramos como o framework ROS 2 e seu protocolo middleware fornecem descoberta automática de dispositivos e interação intensiva (inclusive em tempo real) entre eles dentro de uma rede local, o que é muito conveniente. No entanto, essa abordagem é adequada principalmente para a chamada Zona Confiável - aquela parte da rede de computadores onde a aparição de quaisquer atores de terceiros é improvável. Nesse caso, confiamos em todos os programas em execução e não precisamos usar criptografia, da mesma forma que não é usada dentro de um computador quando programas trocam dados entre si.

Mas e se você precisar garantir o funcionamento de dispositivos ROS 2 com algum serviço externo ou fornecer acesso remoto a eles de fora? Nesses momentos, surge um problema de segurança - ao obter acesso a um nó ROS 2, um serviço externo (e potencialmente uma pessoa mal-intencionada) essencialmente obtém acesso a todos os outros nós - pode ouvir completamente todo o tráfego DDS interno e acessar todos os serviços do sistema disponíveis.

O clássico dilema entre segurança e velocidade/conveniência é resolvido dividindo o sistema soberano de casa inteligente em duas partes - segura e insegura.

## Segurança no ROS 2

Designar uma zona com requisitos especiais de segurança no espaço de trabalho dos nós ROS 2 é uma tarefa bastante não trivial. O pacote padrão de Segurança do ROS 2 ([sros2](https://docs.ros.org/pt/rolling/Concepts/Intermediate/About-Security.html)) faz parte do [ros-core](https://ros.org/reps/rep-2001.html#id32), sobre o qual todas as distribuições ROS 2 são construídas, e de acordo com os desenvolvedores principais, destina-se a resolver este problema. Ele fornece a capacidade de configurar uma infraestrutura de chave pública (PKI) relativamente simples dentro de uma única rede local. Para cada nó ROS 2, são definidas políticas de acesso aos dados de outros nós, bem como um conjunto de arquivos padrão para tais cenários - chaves criptográficas e certificados. Durante a execução do programa, os nós "veem" apenas aquelas fontes de dados às quais o acesso está explicitamente escrito na configuração na fase de lançamento do projeto. No entanto, essa abordagem tem uma grande desvantagem - todo o tráfego no sistema é criptografado, o que pode afetar o desempenho sob a carga de rede criada pelo DDS. Será necessário escrever todas as políticas de acesso e gerar chaves para todos os nós. Isso é muito difícil de configurar e manter. E, o mais importante, estamos perdendo a principal vantagem do Middleware ROS 2 - desempenho.

## Pontes

Outra solução é criar os chamados gateways, que transmitem os dados necessários mantendo todo o resto privado. Normalmente, isso é alcançado usando VPN ou túneis SSH. Um nó separado é criado no espaço de troca de dados segura, que possui um endereço público para conexões externas. Neste caso, a gestão da segurança é realizada apenas ao nível deste nó (essencialmente uma janela para o mundo exterior), sem afetar todos os outros. Essa abordagem é usada nos projetos [Husarnet](https://github.com/husarnet/husarnet), [DDS Router](https://github.com/eProsima/DDS-Router) e [Zenoh Bridge](https://github.com/eclipse-zenoh/zenoh-plugin-ros2dds), mas também possui suas desvantagens. Neste cenário, é necessário estabelecer um canal de comunicação seguro estritamente vinculado ao endereço IP ou nome de domínio da contraparte. Estes podem mudar, ser bloqueados ou vulneráveis a ataques. Na época em que o SSH foi criado, isso não era considerado. Além disso, o SSH depende principalmente do sistema de controle de acesso do sistema operacional, com todas as suas desvantagens inerentes.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/remote_control_legacy_approach.png" alt="Classic Remote Control via public IP and SSH/VPN" />

*Aqui está como os usuários normalmente se conectam remotamente aos seus robôs atualmente. No entanto, essa abordagem apresenta algumas desvantagens. Ela exige um IP público e/ou um nome DNS, que podem ser bloqueados em alguns países. Também requer o armazenamento de chaves privadas adicionais em locais potencialmente inseguros (por exemplo, ~/.ssh).*

O SSH, utilizado principalmente por administradores de sistemas e especialistas em TI, exige conhecimento básico da linha de comando Bash e confiança no sistema operacional, já que as chaves de criptografia são armazenadas diretamente no sistema de arquivos ou no agente SSH. Gerenciar as chaves de acesso continua sendo uma tarefa bastante complexa para o usuário comum, a fim de manter uma forma segura de proteger seus dados.

## Solução Web3

Como podemos ver, os métodos acima não estão isentos de desvantagens, por isso vamos considerar uma possível solução para o problema utilizando tecnologias de rede peer-to-peer, sobre as quais o Robonomics é construído. Neste caso, a nuvem descentralizada do Robonomics pode ser vista como uma tabela de roteamento segura, cujos endereços das contrapartes são as chaves públicas dos nós. Você precisa de um nó local do Robonomics e saber qual chave pública sua contraparte possui, para não depender do sistema DNS (incluindo registradores de nomes de domínio e servidores) e do bloqueio de endereços IP. A biblioteca [libP2P](https://libp2p.io/), que o Robonomics utiliza, pode usar diferentes protocolos de transporte para entrega de mensagens.

Além disso, com o avanço das tecnologias Web3, surgiram métodos mais eficientes para gerenciar informações críticas, incluindo chaves privadas. Um deles é a frase mnemônica ou seed - um conjunto de 12 ou 24 palavras, usado para criar contas em redes descentralizadas. Este método é conveniente e seguro, pois a seed é anotada em um meio externo (por exemplo, em papel) uma única vez durante a inicialização e é usada apenas para recuperar a conta. Uma chave mestra é criada a partir da frase mnemônica, a partir da qual qualquer hierarquia de chaves para diferentes tarefas pode ser criada (veja **[Hierarchical deterministic keys](https://docs.substrate.io/reference/command-line-tools/subkey/#hierarchical-deterministic-keys)**). Isso simplifica o gerenciamento das chaves e sua recuperação caso tenham sido perdidas. Se uma pessoa mal-intencionada obtiver acesso a um dos seus pares de chaves, ela não conseguirá obter informações sobre outras chaves criadas a partir da frase mnemônica. O recurso de chave derivada soft permite confirmar a posse da conta raiz sem revelá-la. Como as chaves soft podem ser derivadas usando a chave pública do pai, elas podem ser usadas para identificar o pai chave sem expor a seed principal.

## Controle remoto no Home Assistant

Vamos examinar o processo de conexão com mais detalhes. O [aplicativo descentralizado Robonomics](https://robonomics.app/) (ou simplesmente DApp) funciona diretamente no seu navegador, não requer a instalação de nenhum software adicional nem a necessidade de armazenar chaves no sistema de arquivos em um ambiente com grande quantidade de programas, cuja segurança não pode ser garantida. O gerenciamento das chaves de acesso é realizado através da extensão Polkadot JS, assim como com a ajuda de um armazenamento externo de chaves de hardware (por exemplo, [Polkadot Vault](https://wiki.polkadot.network/docs/polkadot-vault)) para maior confiabilidade. Além do software especializado para interação com o Robonomics, o DApp também inclui um nó libP2P leve, com o qual ocorre a conexão com o Home Assistant.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_home_assistant_usecase.png" alt="Controle Remoto do Home Assistant" />

O proprietário de uma assinatura do Robonomics Web Service gerencia os direitos de acesso à infraestrutura da casa inteligente através do chamado controlador - uma conta que gerencia todas as informações sensíveis de forma criptografada em um gêmeo digital. Somente usuários adicionados à assinatura podem descriptografar esses dados. Além das chaves de acesso, o Gêmeo Digital também armazena a configuração do DApp e, o chamado, multi-endereço libP2P ao qual o DApp se conecta para uma conexão segura. O multi-endereço é uma das inovações que torna a abordagem libP2P tão única e flexível. Este é um formato especial de endereço para nós, que implica a presença de vários endereços IP, identificadores de transporte e rede, protocolos e portas, através dos quais é possível contatar um nó específico. A lista completa de protocolos suportados está apresentada na [especificação](https://github.com/multiformats/multiaddr/blob/master/protocols.csv).

Assim, o usuário adicionado à assinatura extrai um multi-endereço do gêmeo digital do Robonomics e estabelece uma conexão segura com um Peer ID conhecido apenas por ele. Sucesso!

## Controle Remoto no ROS 2

Da mesma forma, você pode empregar os recursos existentes do Robonomics para interagir com robôs. A equipe Robossembler, sob o Programa de Subsídios Robonomics, desenvolveu um projeto de Prova de Conceito conhecido como [Robonomics Bridge](https://gitlab.com/robossembler/robonomics_bridge). Esta ponte permite seus nós ROS 2 para se conectar com qualquer serviço externo, estação de trabalho remota ou outro sistema ROS 2.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_ros2_usecase.png" alt="Controle Remoto ROS 2 com Robonomics" />

*Uma ilustração de como o controle remoto de um robô doméstico pode ser no caso do ROS 2. Esta abordagem oferece uma série de vantagens significativas: não há necessidade de um IP público, o acesso ao robô está disponível mesmo através de firewalls de rede (NAT), chaves criptográficas privadas não são armazenadas em disco e estão protegidas de forma confiável.*

O protocolo utilizado no ROS 2, DDS, combina-se naturalmente com o libP2P devido ao seu modelo semelhante de publicação-assinatura para interação entre nós. Com a ajuda da ponte Robonomics, os nós ROS 2 e suas interfaces - tópicos, serviços, tipos de mensagens (por exemplo, usando o eProsima Integration Service) podem ser configurados de forma declarativa, permitindo a interação com o robô a partir do exterior. Isso também permite um nível adicional de segurança ao conectar-se a um computador remoto. O mecanismo para obter o PeerID da contraparte pode ser o mesmo do caso com o Home Assistant - através de uma solicitação de Gêmeo Digital do nó Robonomics, com a única diferença de que, em vez do Home Assistant Server, haverá um robô ROS 2, e em vez do libP2P-websocker-proxy, haverá um Robonomics ROS 2 Wrapper conectado ao robô.

## Oportunidades potenciais no futuro

No entanto, essas não são todas as possibilidades que uma nuvem descentralizada baseada em tecnologias Web3 pode oferecer. No exemplo descrito acima, essas tecnologias são usadas para a transmissão relativamente simples de fluxos de dados de mensagens entre computadores remotos.

Isso pode ser chamado de nível básico de transporte na pilha de rede Robonomics, que serve de base para a implementação de protocolos de nível superior mais complexos. Começando por análogos do SSH, que implicam uma interação mais interativa dos usuários com seus sistemas ciberfísicos, e terminando com protocolos de aplicação que implicam a interação de um grande número de usuários de uma infraestrutura robótica autônoma.

Por exemplo, a decisão de iniciar a produção de determinado produto pode ser vinculada a uma votação dentro de uma organização de potenciais consumidores desse produto, considerando a viabilidade econômica. Atualmente, a decisão de iniciar qualquer produção é tomada por meio de mecanismos de investimento, onde investidores, ao receberem informações sobre a demanda potencial, podem adquirir ações de empresas individuais que possam satisfazer essa demanda no futuro. Se os consumidores puderem participar mais ativamente no desenvolvimento e na precificação de novos produtos, então, a longo prazo, podemos mudar para um modo de operação em que a produção se reestruture automaticamente para satisfazer a demanda de acordo com os dados fornecidos pelos consumidores na rede.