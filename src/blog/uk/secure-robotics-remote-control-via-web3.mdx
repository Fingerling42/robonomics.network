---
title: "Безпечне дистанційне керування робототехнікою: рішення Robonomics"
date: 2024-04-19
published: true
locale: 'uk'
cover_image: /blog/images/secure-robotics-remote-control-via-web3/remote_control_cover.png
description: "Віддалене підключення та керування власним розумним пристроєм — дуже популярна функція серед користувачів. Однак навіть таке тривіальне завдання досі викликає багато труднощів у недосвідчених користувачів — від подолання NAT до питань безпеки. У новій статті ми покажемо, як ці труднощі можна подолати за допомогою Robonomics."
related: ['Robonomics Helps Enable Rust for ROS 2', 'Automation: Home meets Industrial']
abstract: "Віддалене підключення та керування власним розумним пристроєм — дуже популярна функція серед користувачів. Однак навіть таке тривіальне завдання досі викликає багато труднощів у недосвідчених користувачів — від подолання NAT до питань безпеки. У новій статті ми покажемо, як ці труднощі можна подолати за допомогою Robonomics."
tags: ['ROS 2', 'Smart Home']
---

У попередній статті ми розповідали про те, як використовуємо переваги промислових рішень в інфраструктурі роботизованого розумного дому. Ми показали, як фреймворк ROS 2 та його протокол middleware забезпечують автоматичне виявлення пристроїв і інтенсивну взаємодію (включаючи роботу в реальному часі) між ними в межах локальної мережі, що дуже зручно. Однак цей підхід здебільшого підходить для так званої Довіреної Зони — тієї частини комп’ютерної мережі, де поява сторонніх учасників малоймовірна. У цьому випадку ми довіряємо всім запущеним програмам і не потребуємо шифрування так само, як воно не використовується в межах одного комп’ютера, коли програми обмінюються даними між собою.

Але що робити, якщо потрібно забезпечити роботу пристроїв ROS 2 з якимось зовнішнім сервісом або надати до них віддалений доступ ззовні? У такі моменти виникає проблема безпеки — отримавши доступ до одного вузла ROS 2, зовнішній сервіс (а потенційно й зловмисник) фактично отримує доступ до всіх інших вузлів — він може повністю прослуховувати весь внутрішній трафік DDS і отримувати доступ до всіх доступних системних сервісів.

Класичний компроміс між безпекою та швидкістю/зручністю вирішується шляхом поділу суверенної системи розумного дому на дві частини — безпечну та небезпечну.

## Безпека ROS 2

Виділення зони зі спеціальними вимогами до безпеки в робочому просторі вузлів ROS 2 — досить нетривіальне завдання. Стандартний пакет безпеки ROS 2 ([sros2](https://docs.ros.org/uk/rolling/Concepts/Intermediate/About-Security.html)) є частиною [ros-core](https://ros.org/reps/rep-2001.html#id32), на якому побудовані всі дистрибутиви ROS 2, і, за словами основних розробників, покликана вирішити цю проблему. Вона надає можливість налаштувати відносно просту інфраструктуру відкритих ключів (PKI) в межах однієї локальної мережі. Для кожного вузла ROS 2 задаються політики доступу до даних інших вузлів, а також набір стандартних файлів для таких сценаріїв — криптографічні ключі та сертифікати. Під час виконання програми вузли "бачать" лише ті джерела даних, до яких доступ явно прописаний у конфігурації на етапі запуску проєкту. Однак у такого підходу є суттєвий недолік — весь трафік у системі шифрується, що може вплинути на продуктивність при навантаженні на мережу, створюваному DDS. Доведеться прописати всі політики доступу та згенерувати ключі для всіх вузлів. Це дуже складно налаштовувати та підтримувати. І найголовніше — ми втрачаємо основну перевагу ROS 2 Middleware — продуктивність.

## Мости

Інше рішення — створення так званих шлюзів, які передають необхідні дані, залишаючи все інше приватним. Зазвичай це досягається за допомогою VPN або SSH-тунелів. У просторі безпечного обміну даними створюється окремий вузол, який має публічну адресу для зовнішніх підключень. У цьому випадку керування безпекою здійснюється лише на рівні цього вузла (по суті, вікна у зовнішній світ), не зачіпаючи всі інші. Такий підхід використовується у проєктах [Husarnet](https://github.com/husarnet/husarnet), [DDS Router](https://github.com/eProsima/DDS-Router) та [Zenoh Bridge](https://github.com/eclipse-zenoh/zenoh-plugin-ros2dds), але і в нього є свої недоліки. У цьому сценарії потрібно встановити захищений канал зв'язку, жорстко прив'язаний до IP-адреси або доменного імені контрагента. Вони можуть змінюватися, блокуватися або бути вразливими до атак. На момент створення SSH це не враховувалося. Крім того, SSH в основному спирається на систему контролю доступу операційної системи, з усіма її притаманними недоліками.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/remote_control_legacy_approach.png" alt="Classic Remote Control via public IP and SSH/VPN" />

*Ось як користувачі зазвичай підключаються до своїх роботів віддалено сьогодні. Однак цей підхід має певні недоліки. Він вимагає наявності публічної IP-адреси або/та DNS-імені, які можуть бути заблоковані в деяких країнах. Також необхідно зберігати додаткові приватні ключі у потенційно небезпечних місцях (наприклад, ~/.ssh).*

SSH, який в основному використовується системними адміністраторами та IT-спеціалістами, вимагає базових знань командного рядка Bash і довіри до операційної системи, оскільки ключі шифрування зберігаються безпосередньо у файловій системі або агенті SSH. Управління ключами доступу залишається досить складним завданням для пересічного користувача, щоб залишатися безпечним способом захисту своїх даних.

## Web3-рішення

Як ми бачимо, наведені вище методи не позбавлені недоліків, тому розглянемо можливе вирішення проблеми за допомогою технологій однорангових мереж, на яких побудований Robonomics. У цьому випадку децентралізована хмара Robonomics може розглядатися як безпечна таблиця маршрутизації, адресами контрагентів у якій є публічні ключі вузлів. Вам потрібен локальний вузол Robonomics і знання того, який публічний ключ має ваш контрагент, щоб не залежати від системи DNS (включаючи реєстраторів доменних імен і серверів) та блокування IP-адрес. Бібліотека [libP2P](https://libp2p.io/), яку використовує Robonomics, може використовувати різні транспортні протоколи для доставки повідомлень.

Крім того, з розвитком технологій Web3 з'явилися більш ефективні методи управління критичною інформацією, включаючи приватні ключі. Одним із них є мнемонічна фраза або seed — набір із 12 або 24 слів, що використовується для створення акаунтів у децентралізованих мережах. Цей метод зручний і безпечний, оскільки seed записується на зовнішній носій (наприклад, на папір) один раз під час ініціалізації і використовується лише для відновлення акаунта. З мнемонічної фрази створюється майстер-ключ, з якого можна створити будь-яку ієрархію ключів для різних завдань (див. **[Ієрархічні детерміновані ключі](https://docs.substrate.io/reference/command-line-tools/subkey/#hierarchical-deterministic-keys)**). Це спрощує управління ключами та їх відновлення у разі втрати. Якщо зловмисник отримає доступ до однієї з ваших пар ключів, він не зможе отримати інформацію про інші ключі, створені з мнемонічної фрази. Функція soft derived key дозволяє підтвердити право власності на кореневий акаунт, не розкриваючи його. Оскільки soft-ключі можуть бути отримані за допомогою батьківського публічного ключа, їх можна використовувати для ідентифікації батьківськогоключ без розкриття батьківської seed-фрази.

## Віддалене керування в Home Assistant

Розглянемо процес підключення детальніше. Децентралізований [додаток Robonomics](https://robonomics.app/) (або просто DApp) працює безпосередньо у вашому браузері, не вимагаючи встановлення додаткового програмного забезпечення чи необхідності зберігати ключі у файловій системі серед великої кількості програм, у безпеці яких ви не можете бути впевнені. Управління ключами доступу здійснюється через розширення Polkadot JS, а також за допомогою зовнішнього апаратного сховища ключів (наприклад, [Polkadot Vault](https://wiki.polkadot.network/docs/polkadot-vault)) для додаткової надійності. Окрім спеціалізованого програмного забезпечення для взаємодії з Robonomics, DApp також містить легкий вузол libP2P, за допомогою якого відбувається підключення до Home Assistant.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_home_assistant_usecase.png" alt="Віддалене керування Home Assistant" />

Власник підписки Robonomics Web Service керує правами доступу до інфраструктури розумного дому через так званий контролер — обліковий запис, який управляє всією чутливою інформацією у зашифрованому вигляді у цифровому двійнику. Розшифрувати ці дані можуть лише користувачі, додані до підписки. Окрім ключів доступу, у цифровому двійнику також зберігається конфігурація DApp і так звана libP2P multi-address, до якої DApp підключається для безпечного з'єднання. Multi-address — це одна з інновацій, що робить підхід libP2P таким унікальним і гнучким. Це спеціальний формат адреси для вузлів, який передбачає наявність багатьох IP-адрес, транспортних і мережевих ідентифікаторів, протоколів і портів, через які можна звернутися до конкретного вузла. Повний список підтримуваних протоколів представлений у [специфікації](https://github.com/multiformats/multiaddr/blob/master/protocols.csv).

Отже, користувач, доданий до підписки, отримує multi-address із цифрового двійника Robonomics і встановлює безпечне з'єднання з Peer ID, відомим лише йому. Успіх!

## Віддалене керування в ROS 2

Аналогічно, ви можете використовувати наявні можливості Robonomics для взаємодії з роботами. Команда Robossembler у межах програми грантів Robonomics розробила проект Proof of Concept під назвою [Robonomics Bridge](https://gitlab.com/robossembler/robonomics_bridge). Цей міст дозволяєваші вузли ROS 2 можуть підключатися до будь-якого зовнішнього сервісу, віддаленої робочої станції або іншої системи ROS 2.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_ros2_usecase.png" alt="Віддалене керування ROS 2 з Robonomics" />

*Ілюстрація того, як може виглядати віддалене керування домашнім роботом у випадку з ROS 2. Такий підхід має низку суттєвих переваг: немає потреби у публічній IP-адресі, доступ до робота можливий навіть через мережеві фаєрволи (NAT), приватні криптографічні ключі не зберігаються на диску та надійно захищені.*

Протокол, що використовується в ROS 2, DDS, природно поєднується з libP2P завдяки схожій моделі взаємодії вузлів видавець-підписник. За допомогою мосту Robonomics вузли ROS 2 та їхні інтерфейси — топіки, сервіси, типи повідомлень (наприклад, використовуючи eProsima Integration Service) — можна декларативно налаштовувати, через які можлива взаємодія з роботом ззовні. Це також дозволяє забезпечити додатковий рівень безпеки при підключенні до віддаленого комп’ютера. Механізм отримання PeerID контрагента може бути таким самим, як і у випадку з Home Assistant — через запит Digital Twin від вузла Robonomics, з тією лише різницею, що замість сервера Home Assistant буде робот ROS 2, а замість libP2P-websocker-proxy — Robonomics ROS 2 Wrapper, підключений до робота.

## Потенційні можливості в майбутньому

Однак це не всі можливості, які може запропонувати децентралізована хмара на основі Web3-технологій. У наведеному вище прикладі ці технології використовуються для відносно простої передачі потоків даних повідомлень між віддаленими комп’ютерами.

Це можна назвати базовим транспортним рівнем у стеку мережі Robonomics, який є основою для реалізації більш складних протоколів вищого рівня. Починаючи з аналогів SSH, що передбачають більш інтерактивну взаємодію користувачів зі своїми кібер-фізичними системами, і закінчуючи прикладними протоколами, які передбачають взаємодію великої кількості користувачів автономної роботизованої інфраструктури.

Наприклад, рішення про початок виробництва певного продукту може бути пов’язане з голосуванням всередині організації потенційних споживачів цього продукту з урахуванням економічної доцільності. Наразі рішення про початок будь-якого виробництва приймається через інвестиційні механізми, де інвестори, отримавши інформацію про потенційний попит, можуть придбати акції окремих компаній, які зможуть задовольнити цей попит у майбутньому. Якщо споживачі зможуть брати більш активну участь у розробці та ціноутворенні нових продуктів, то в довгостроковій перспективі ми зможемо перейти до такого режиму роботи, коли виробництво автоматично перебудовуватиметься для задоволення попиту відповідно до даних, наданих споживачами в мережу.