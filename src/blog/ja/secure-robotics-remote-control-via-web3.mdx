---
title: "セキュアなロボティクス遠隔操作：Robonomicsソリューション"
date: 2024-04-19
published: true
locale: 'ja'
cover_image: /blog/images/secure-robotics-remote-control-via-web3/remote_control_cover.png
description: "自分のスマートデバイスへのリモート接続と操作は、ユーザーの間で非常に人気のある機能です。しかし、このような一見簡単な作業でも、NATの突破からセキュリティの問題まで、経験の浅いユーザーには多くの困難が伴います。新しい記事では、Robonomicsの助けを借りてこれらの困難をどのように克服できるかを紹介します。"
related: ['Robonomics Helps Enable Rust for ROS 2', 'Automation: Home meets Industrial']
abstract: "自分のスマートデバイスへのリモート接続と操作は、ユーザーの間で非常に人気のある機能です。しかし、このような一見簡単な作業でも、NATの突破からセキュリティの問題まで、経験の浅いユーザーには多くの困難が伴います。新しい記事では、Robonomicsの助けを借りてこれらの困難をどのように克服できるかを紹介します。"
tags: ['ROS 2', 'Smart Home']
---

前回の記事では、ロボット化されたスマートホームのインフラにおいて、産業用ソリューションの利点をどのように活用しているかについて説明しました。ROS 2フレームワークとそのミドルウェアプロトコルが、ローカルネットワーク内での自動デバイス検出や集中的な相互作用（リアルタイムを含む）をどのように提供しているかを示し、非常に便利であることを紹介しました。しかし、このアプローチは主に、いわゆる「信頼ゾーン」―第三者の出現がほとんどないと考えられるコンピュータネットワークの一部―に適しています。この場合、すべての実行中のプログラムを信頼しており、プログラム同士がデータをやり取りする際に暗号化を使用しないのと同様に、暗号化を使用する必要はありません。

しかし、ROS 2デバイスを外部サービスと連携させたり、外部からリモートアクセスを提供したりする必要がある場合はどうでしょうか？このような場合、セキュリティの問題が発生します。1つのROS 2ノードへのアクセスを得た外部サービス（そして潜在的には悪意のある人物）は、実質的に他のすべてのノードへのアクセスも得ることになります。すべての内部DDSトラフィックを完全に傍受し、利用可能なすべてのシステムサービスにアクセスできてしまうのです。

セキュリティと速度・利便性の間の古典的なトレードオフは、主権的なスマートホームシステムをセキュアな部分と非セキュアな部分の2つに分割することで解決されます。

## ROS 2のセキュリティ

ROS 2ノードのワークスペース内で特別なセキュリティ要件を持つゾーンを指定することは、かなり難しい課題です。標準のROS 2セキュリティパッケージ（[sros2](https://docs.ros.org/ja/rolling/Concepts/Intermediate/About-Security.html)) は [ros-core](https://ros.org/reps/rep-2001.html#id32) の一部であり、すべての ROS 2 ディストリビューションの基盤となっています。コア開発者によれば、これはこの問題を解決することを目的としています。単一のローカルネットワーク内で比較的シンプルな公開鍵基盤（PKI）を構築する機能を提供します。各 ROS 2 ノードごとに、他のノードのデータへのアクセス方針が設定され、そのようなシナリオ用の標準ファイルセット（暗号鍵や証明書）が用意されます。プログラム実行中、ノードはプロジェクト起動時の設定で明示的にアクセスが記述されたデータソースのみを「見る」ことができます。しかし、このアプローチには大きな欠点があります。システム内のすべてのトラフィックが暗号化されるため、DDS によって生じるネットワーク負荷下でパフォーマンスに影響を与える可能性があります。すべてのノードに対してアクセス方針を記述し、鍵を生成する必要があります。これは設定や保守が非常に困難です。そして最も重要なのは、ROS 2 ミドルウェアの最大の利点であるパフォーマンスを失ってしまうことです。

## ブリッジ

もう一つの解決策は、いわゆるゲートウェイを作成し、必要なデータのみを転送し、それ以外はすべて非公開にする方法です。通常、これは VPN や SSH トンネルを使用して実現されます。セキュアなデータ交換空間内に、外部接続用のパブリックアドレスを持つ別のノードが作成されます。この場合、セキュリティ管理はこのノード（本質的には外部への窓口）レベルでのみ行われ、他のすべてには影響しません。このアプローチは [Husarnet](https://github.com/husarnet/husarnet)、[DDS Router](https://github.com/eProsima/DDS-Router)、[Zenoh Bridge](https://github.com/eclipse-zenoh/zenoh-plugin-ros2dds) などのプロジェクトで使用されていますが、やはり欠点もあります。このシナリオでは、通信相手の IP アドレスやドメイン名に厳密に紐づいたセキュアな通信チャネルを確立する必要があります。これらは変更されたり、ブロックされたり、攻撃に対して脆弱になる可能性があります。SSH が作られた当時は、これは考慮されていませんでした。さらに、SSH は主にオペレーティングシステムのアクセス制御システムに依存しており、そこに内在するすべての欠点を持っています。

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/remote_control_legacy_approach.png" alt="Classic Remote Control via public IP and SSH/VPN"---

*ユーザーが最近リモートでロボットに接続する一般的な方法です。しかし、この方法にはいくつかの欠点があります。パブリックIPやDNS名が必要であり、これは一部の国ではブロックされる可能性があります。また、追加の秘密鍵を安全でない場所（例：~/.ssh）に保存する必要があります。*

SSHは主にシステム管理者やITスペシャリストによって使用され、Bashコマンドラインの基本的な知識と、暗号鍵がファイルシステムやSSHエージェントに直接保存されるため、オペレーティングシステムへの信頼が必要です。アクセスキーの管理は、一般ユーザーにとっては安全な方法でデータを保護し続けるにはかなり複雑な作業です。

## Web3ソリューション

上記の方法にも欠点があることがわかるので、Robonomicsが構築されているピアツーピアネットワーク技術を用いた問題の解決策を検討します。この場合、分散型Robonomicsクラウドは安全なルーティングテーブルと見なすことができ、その中のカウンターパーティのアドレスはノードの公開鍵です。ローカルのRobonomicsノードと、カウンターパーティが持つ公開鍵の情報が必要であり、DNSシステム（ドメイン名レジストラやサーバーを含む）やIPアドレスのブロックに依存しません。[libP2P](https://libp2p.io/)ライブラリ（Robonomicsが使用）は、メッセージ配信のためにさまざまなトランスポートプロトコルを利用できます。

さらに、Web3技術の進歩により、秘密鍵を含む重要な情報を管理するためのより効率的な方法が登場しました。その一つがニーモニックフレーズまたはシードです。これは12語または24語のセットで、分散型ネットワークでアカウントを作成するために使用されます。この方法は便利かつ安全で、シードは初期化時に一度だけ外部媒体（例：紙）に書き留められ、アカウントの復元時のみに使用されます。ニーモニックフレーズからマスターキーが作成され、そこからさまざまなタスク用の任意のキー階層を作成できます（**[階層的決定性キー](https://docs.substrate.io/reference/command-line-tools/subkey/#hierarchical-deterministic-keys)**を参照）。これにより、キーの管理や紛失時の復元が簡単になります。悪意のある人物があなたのキーペアの一つにアクセスしても、ニーモニックフレーズから作成された他のキーの情報を得ることはできません。ソフト派生キー機能により、ルートアカウントを公開せずに所有権を証明できます。ソフトキーは親公開鍵を使って派生できるため、親を識別するのに利用できます。キーを親シードを公開せずに利用できます。

## Home Assistantでのリモートコントロール

接続プロセスをより詳しく見てみましょう。分散型の[Robonomicsアプリケーション](https://robonomics.app/)（DApp）は、ブラウザ上で直接動作し、追加のソフトウェアをインストールしたり、多数のプログラムが存在するファイルシステム上にキーを保存したりする必要がありません。そのため、セキュリティが確保できない環境でのリスクを回避できます。アクセスキーの管理はPolkadot JS拡張機能や、さらなる信頼性のために外部ハードウェアキー（例：[Polkadot Vault](https://wiki.polkadot.network/docs/polkadot-vault)）を利用して行います。Robonomicsとのやり取りのための専用ソフトウェアに加え、DAppには軽量なlibP2Pノードも含まれており、これを通じてHome Assistantとの接続が行われます。

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_home_assistant_usecase.png" alt="Home Assistant Remote Control" />

Robonomics Web Serviceサブスクリプションの所有者は、コントローラーと呼ばれるアカウントを通じてスマートホームインフラへのアクセス権を管理します。コントローラーは、すべての機密情報を暗号化された形でデジタルツイン内に管理します。このデータを復号できるのは、サブスクリプションに追加されたユーザーのみです。アクセスキーに加え、デジタルツインにはDAppの設定や、DAppが安全に接続するためのlibP2Pマルチアドレスも保存されます。マルチアドレスは、libP2Pのアプローチを非常にユニークかつ柔軟にしている革新的な仕組みの一つです。これはノードのための特別なアドレス形式で、多数のIPアドレス、トランスポートやネットワーク識別子、プロトコル、ポートなどを含み、特定のノードに接続することができます。サポートされているプロトコルの全リストは[仕様書](https://github.com/multiformats/multiaddr/blob/master/protocols.csv)で確認できます。

このようにして、サブスクリプションに追加されたユーザーはRobonomicsデジタルツインからマルチアドレスを取得し、自分だけが知るPeer IDで安全な接続を確立します。成功です！

## ROS 2でのリモートコントロール

同様に、Robonomicsの既存機能を利用してロボットとやり取りすることも可能です。Robonomics Grant Programのもと、Robossemblerチームは[Robonomics Bridge](https://gitlab.com/robossembler/robonomics_bridge)というProof of Conceptプロジェクトを開発しました。このブリッジはあなたのROS 2ノードを、あらゆる外部サービス、リモートワークステーション、または他のROS 2システムと接続することができます。

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_ros2_usecase.png" alt="ROS 2 Remote Control with Robonomics" />

*ROS 2を用いた家庭用ロボットのリモートコントロールのイメージ図。このアプローチには多くの重要な利点があります。パブリックIPが不要であり、ネットワークファイアウォール（NAT）を通じてもロボットへのアクセスが可能です。秘密鍵はディスクに保存されず、確実に保護されます。*

ROS 2で使用されているプロトコルであるDDSは、ノード間のやり取りにおいてパブリッシャー・サブスクライバーモデルが類似しているため、libP2Pと自然に組み合わせることができます。Robonomicsブリッジの助けを借りて、ROS 2ノードおよびそのインターフェース（トピック、サービス、メッセージタイプなど、例えばeProsima Integration Serviceを使用）を宣言的に設定でき、これにより外部からロボットとのやり取りが可能になります。これにより、リモートコンピュータへの接続時に追加のセキュリティレベルも提供されます。カウンターパーティのPeerIDを取得する仕組みは、Home Assistantの場合と同様に、Robonomicsノードからのデジタルツインリクエストを通じて行うことができます。唯一の違いは、Home Assistantサーバーの代わりにROS 2ロボットがあり、libP2P-websocker-proxyの代わりにロボットに接続されたRobonomics ROS 2 Wrapperがある点です。

## 将来の潜在的な機会

しかし、Web3技術による分散型クラウドが提供できる可能性はこれだけではありません。上記の例では、これらの技術はリモートコンピュータ間でメッセージデータストリームを比較的単純に送信するために使用されています。

これはRobonomicsネットワークスタックの基本的なトランスポートレベルと呼ぶことができ、より複雑な上位プロトコルの実装の基盤となります。SSHの類似プロトコルのように、ユーザーとサイバーフィジカルシステムとのよりインタラクティブなやり取りを想定したものから、多数のユーザーが自律型ロボットインフラストラクチャを利用するアプリケーションプロトコルまで、さまざまな応用が考えられます。

例えば、特定の製品の生産開始の決定を、その製品の潜在的な消費者組織内での投票に結び付け、経済的な妥当性を考慮することができます。現在、いかなる生産開始の決定も、投資メカニズムを通じて行われており、投資家は潜在的な需要に関する情報を得た上で、将来的にその需要を満たすことができる個々の企業の株式を取得することができます。. もし消費者が新製品の開発や価格設定により積極的に参加できるようになれば、長期的には、消費者がネットワークに提供するデータに基づいて需要を満たすように生産が自動的に再構築される運用モードへと切り替えることが可能になります。