---
title: "Безопасное дистанционное управление робототехникой: решение Robonomics"
date: 2024-04-19
published: true
locale: 'ru'
cover_image: /blog/images/secure-robotics-remote-control-via-web3/remote_control_cover.png
description: "Удалённое подключение и управление собственным умным устройством — очень популярная функция среди пользователей. Однако даже такая тривиальная задача до сих пор вызывает множество трудностей у неопытных пользователей — от преодоления NAT до вопросов безопасности. В новой статье мы покажем, как эти трудности можно преодолеть с помощью Robonomics."
related: ['Robonomics Helps Enable Rust for ROS 2', 'Automation: Home meets Industrial']
abstract: "Удалённое подключение и управление собственным умным устройством — очень популярная функция среди пользователей. Однако даже такая тривиальная задача до сих пор вызывает множество трудностей у неопытных пользователей — от преодоления NAT до вопросов безопасности. В новой статье мы покажем, как эти трудности можно преодолеть с помощью Robonomics."
tags: ['ROS 2', 'Smart Home']
---

В предыдущей статье мы рассказали о том, как используем преимущества промышленных решений в инфраструктуре роботизированного умного дома. Мы показали, как фреймворк ROS 2 и его протокол промежуточного программного обеспечения обеспечивают автоматическое обнаружение устройств и интенсивное взаимодействие (в том числе в реальном времени) между ними внутри локальной сети, что очень удобно. Однако этот подход в основном подходит для так называемой Доверенной зоны — той части компьютерной сети, где появление сторонних участников маловероятно. В этом случае мы доверяем всем запущенным программам и не нуждаемся в использовании шифрования, так же как оно не используется внутри одного компьютера при обмене данными между программами.

Но что делать, если необходимо обеспечить работу устройств ROS 2 с каким-либо внешним сервисом или предоставить к ним удалённый доступ извне? В такие моменты возникает проблема безопасности — получив доступ к одному узлу ROS 2, внешний сервис (а потенциально и злоумышленник) фактически получает доступ ко всем остальным узлам — он может полностью прослушивать весь внутренний трафик DDS и обращаться ко всем доступным системным сервисам.

Классический компромисс между безопасностью и скоростью/удобством решается путём разделения суверенной системы умного дома на две части — защищённую и незащищённую.

## Безопасность ROS 2

Обозначить зону с особыми требованиями к безопасности в рабочем пространстве узлов ROS 2 — довольно нетривиальная задача. Стандартный пакет безопасности ROS 2 ([sros2](https://docs.ros.org/ru/rolling/Concepts/Intermediate/About-Security.html)) является частью [ros-core](https://ros.org/reps/rep-2001.html#id32), на котором строятся все дистрибутивы ROS 2, и, по словам основных разработчиков, предназначен для решения этой проблемы. Он предоставляет возможность настроить относительно простую инфраструктуру открытых ключей (PKI) внутри одной локальной сети. Для каждого узла ROS 2 задаются политики доступа к данным других узлов, а также набор стандартных файлов для таких сценариев — криптографические ключи и сертификаты. Во время выполнения программы узлы «видят» только те источники данных, к которым явно прописан доступ в конфигурации на этапе запуска проекта. Однако у этого подхода есть существенный недостаток — весь трафик в системе шифруется, что может сказаться на производительности при сетевой нагрузке, создаваемой DDS. Придётся прописывать все политики доступа и генерировать ключи для всех узлов. Это очень сложно настроить и поддерживать. И самое главное — мы теряем главное преимущество ROS 2 Middleware — производительность.

## Мосты

Другое решение — создание так называемых шлюзов, которые передают необходимые данные, сохраняя всё остальное приватным. Обычно это достигается с помощью VPN или SSH-туннелей. В пространстве защищённого обмена данными создаётся отдельный узел, который имеет публичный адрес для внешних подключений. В этом случае управление безопасностью осуществляется только на уровне этого узла (по сути, окна во внешний мир), не затрагивая все остальные. Такой подход используется в проектах [Husarnet](https://github.com/husarnet/husarnet), [DDS Router](https://github.com/eProsima/DDS-Router) и [Zenoh Bridge](https://github.com/eclipse-zenoh/zenoh-plugin-ros2dds), но и у него есть свои недостатки. В этом сценарии необходимо устанавливать защищённый канал связи, строго привязанный к IP-адресу или доменному имени контрагента. Они могут меняться, блокироваться или быть уязвимыми для атак. Во времена создания SSH это не учитывалось. Кроме того, SSH в основном опирается на систему контроля доступа операционной системы со всеми её присущими недостатками.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/remote_control_legacy_approach.png" alt="Classic Remote Control via public IP and SSH/VPN" />

*Вот как пользователи обычно подключаются к своим роботам удалённо в наши дни. Однако у этого подхода есть некоторые недостатки. Он требует наличия публичного IP-адреса и/или DNS-имени, которые могут быть заблокированы в некоторых странах. Также необходимо хранить дополнительные приватные ключи в потенциально небезопасных местах (например, ~/.ssh).*

SSH, в первую очередь используемый системными администраторами и IT-специалистами, требует базовых знаний командной строки Bash и доверия к операционной системе, так как ключи шифрования хранятся непосредственно в файловой системе или агенте SSH. Управление ключами доступа остаётся довольно сложной задачей для обычного пользователя, чтобы оставаться безопасным способом защиты своих данных.

## Решение Web3

Как видно, приведённые выше методы не лишены недостатков, поэтому мы рассмотрим возможное решение проблемы с использованием технологий одноранговых сетей, на которых построен Robonomics. В этом случае децентрализованное облако Robonomics можно рассматривать как безопасную таблицу маршрутизации, адресами контрагентов в которой являются публичные ключи узлов. Вам потребуется локальный узел Robonomics и знание публичного ключа вашего контрагента, чтобы не зависеть от системы DNS (включая регистраторов доменных имён и серверов) и блокировки IP-адресов. Библиотека [libP2P](https://libp2p.io/), которую использует Robonomics, может использовать различные транспортные протоколы для доставки сообщений.

Более того, с развитием технологий Web3 появились более эффективные методы управления критической информацией, включая приватные ключи. Один из них — это мнемоническая фраза или seed — набор из 12 или 24 слов, используемых для создания аккаунтов в децентрализованных сетях. Этот способ удобен и безопасен, так как seed записывается на внешний носитель (например, на бумагу) один раз при инициализации и используется только для восстановления аккаунта. Из мнемонической фразы создаётся мастер-ключ, из которого можно создать любую иерархию ключей для различных задач (см. **[Иерархические детерминированные ключи](https://docs.substrate.io/reference/command-line-tools/subkey/#hierarchical-deterministic-keys)**). Это упрощает управление ключами и их восстановление в случае утери. Если злоумышленник получит доступ к одной из ваших пар ключей, он не сможет получить информацию о других ключах, созданных из мнемонической фразы. Функция мягко производных ключей позволяет подтвердить владение корневым аккаунтом, не раскрывая его. Поскольку мягкие ключи могут быть получены с использованием родительского публичного ключа, их можно использовать для идентификации родителяключ без раскрытия родительской seed-фразы.

## Удалённое управление в Home Assistant

Рассмотрим процесс подключения более подробно. Децентрализованное [приложение Robonomics](https://robonomics.app/) (или просто DApp) работает непосредственно в вашем браузере, не требует установки дополнительного программного обеспечения или необходимости хранить ключи в файловой системе в окружении множества программ, в безопасности которых вы не можете быть уверены. Управление ключами доступа осуществляется через расширение Polkadot JS, а также с помощью внешнего аппаратного хранилища ключей (например, [Polkadot Vault](https://wiki.polkadot.network/docs/polkadot-vault)) для дополнительной надёжности. Помимо специализированного ПО для взаимодействия с Robonomics, DApp также включает облегчённый libP2P-узел, с помощью которого осуществляется подключение к Home Assistant.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_home_assistant_usecase.png" alt="Удалённое управление Home Assistant" />

Владелец подписки Robonomics Web Service управляет правами доступа к инфраструктуре умного дома с помощью так называемого контроллера — аккаунта, который управляет всей чувствительной информацией в зашифрованном виде в цифровом двойнике. Только пользователи, добавленные в подписку, могут расшифровать эти данные. Помимо ключей доступа, в цифровом двойнике также хранятся конфигурация DApp и так называемый libP2P multi-address, к которому DApp подключается для безопасного соединения. Multi-address — это одно из тех нововведений, которые делают подход libP2P таким уникальным и гибким. Это специальный формат адреса для узлов, который подразумевает наличие множества IP-адресов, транспортных и сетевых идентификаторов, протоколов и портов, через которые можно связаться с конкретным узлом. Полный список поддерживаемых протоколов представлен в [спецификации](https://github.com/multiformats/multiaddr/blob/master/protocols.csv).

Итак, пользователь, добавленный в подписку, извлекает multi-address из цифрового двойника Robonomics и устанавливает защищённое соединение с Peer ID, известным только ему. Успех!

## Удалённое управление в ROS 2

Аналогично, вы можете использовать существующие возможности Robonomics для взаимодействия с роботами. Команда Robossembler в рамках программы грантов Robonomics разработала проект Proof of Concept под названием [Robonomics Bridge](https://gitlab.com/robossembler/robonomics_bridge). Этот мост позволяетваши ROS 2-узлы могут подключаться к любому внешнему сервису, удалённой рабочей станции или другой системе ROS 2.

<RbImage zoom src="/blog/images/secure-robotics-remote-control-via-web3/robonomics_ros2_usecase.png" alt="ROS 2 Remote Control with Robonomics" />

*Иллюстрация того, как может выглядеть удалённое управление домашним роботом в случае ROS 2. Такой подход даёт ряд существенных преимуществ: нет необходимости в публичном IP, доступ к роботу возможен даже через сетевые файерволы (NAT), приватные криптографические ключи не хранятся на диске и надёжно защищены.*

Протокол, используемый в ROS 2, DDS, естественным образом сочетается с libP2P благодаря схожей модели взаимодействия узлов по принципу издатель-подписчик. С помощью моста Robonomics ROS 2-узлы и их интерфейсы — топики, сервисы, типы сообщений (например, с использованием eProsima Integration Service) — могут быть декларативно сконфигурированы, что позволяет организовать взаимодействие с роботом извне. Это также обеспечивает дополнительный уровень безопасности при подключении к удалённому компьютеру. Механизм получения PeerID контрагента может быть таким же, как и в случае с Home Assistant — через запрос Digital Twin от узла Robonomics, с единственным отличием, что вместо сервера Home Assistant будет ROS 2-робот, а вместо libP2P-websocker-proxy — Robonomics ROS 2 Wrapper, подключённый к роботу.

## Потенциальные возможности в будущем

Однако это не все возможности, которые может предложить децентрализованное облако на технологиях Web3. В приведённом выше примере эти технологии используются для относительно простой передачи потоков данных сообщений между удалёнными компьютерами.

Это можно назвать базовым транспортным уровнем в сетевом стеке Robonomics, который служит основой для реализации более сложных протоколов верхнего уровня. Начиная с аналогов SSH, предполагающих более интерактивное взаимодействие пользователей со своими кибер-физическими системами, и заканчивая прикладными протоколами, подразумевающими взаимодействие большого числа пользователей автономной роботизированной инфраструктуры.

Например, решение о запуске производства определённого продукта может быть связано с голосованием внутри организации потенциальных потребителей этого продукта с учётом экономической целесообразности. В настоящее время решение о запуске любого производства принимается через инвестиционные механизмы, когда инвесторы, получив информацию о потенциальном спросе, могут приобретать акции отдельных компаний, которые смогут удовлетворить этот спрос в будущем.. Если потребители смогут более активно участвовать в разработке и ценообразовании новых продуктов, то в долгосрочной перспективе мы сможем перейти к такому режиму работы, когда производство будет автоматически перестраиваться для удовлетворения спроса на основе данных, предоставляемых потребителями в сеть.